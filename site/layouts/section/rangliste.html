{{ define "main" }}

  <h1 class="center tc f2 pa2">Rangliste</h1>
  <div class="center grey-3 tc">
    <p class="center tc">{{ .Date.Format "Mon, Jan 2, 2006" }}</p>
  </div>
  
  {{ if .Params.image }}<div class="center"><img src="{{ .Params.image }}" alt="{{ .Title }}" /></div>{{ end }}

  <div id="myBet" class="pa2" style="position: fixed; top: 20px; right:20px; background-color: rgb(250, 250, 250);">
  </div>

  <div id="autoRankingList">

  </div>

  <script src="/game/game.js"></script>
  <script>
    (function() {
      fetch("https://dabeiseinistalles.blob.core.windows.net/data/prices.json")
        .then(function(res){ return res.json() })
        .then(function(prices){
          var byValorSymbol = mapByValorSymbol(prices)
          initRankingList("20200327", byValorSymbol, getBets())
          initMyBet(byValorSymbol, getValorSymbolsUsed())
        })

        function initRankingList(referenceDate, prices, players) {
          var rankingListData = calculateRankingList(referenceDate, prices, players)
          document.getElementById("autoRankingList").innerHTML = rangkingListHtmlTable(rankingListData)
        }

        function initMyBet(byValorSymbol, valorSymbolsUsed) {
          var container = document.getElementById("myBet")
          var optionHtml = valorSymbolsUsed.map(function(valorSymbol){
            return '<option value="' + valorSymbol + '">' + byValorSymbol[valorSymbol].shortName + '</option>'
          })
          var selects = ""
          for(var i = 0; i < 4; i++){

            selects += '<select>' + optionHtml + '</select>'
          }

          container.innerHTML = selects
        }
    })()
  </script>

{{ end }}
